{% extends "administration/administrationView.html" %}

{% block mainContent %}

<div class="partialView">
    <h1>Zastępstwa</h1>

    <div class="menu">
        <label for="class-select">Wybierz klasę:</label>
        <select id="class-select"></select>
    </div>

    <div class="mainContent">
        <!-- Kalendarz -->
        <div id="calendar"></div>

        <!-- Formularz zastępstw -->
        <div class="replacementForm">
            <h2>Dodaj zastępstwo</h2>
            <form id="replacementForm">
                <label for="class">Klasa:</label>
                <select id="replacement-class-select"></select>
                <br>
                <label for="subject">Przedmiot:</label>
                <input type="text" id="subject" placeholder="Nazwa przedmiotu" required>
                <br>
                <label for="teacher">Nauczyciel:</label>
                <input type="text" id="teacher" placeholder="Imię i nazwisko nauczyciela" required>
                <br>
                <label for="date">Data:</label>
                <input type="date" id="date" required>
                <br>
                <label for="startTime">Godzina rozpoczęcia:</label>
                <input type="time" id="startTime" required min="08:00" max="17:00">
                <br>
                <label for="endTime">Godzina zakończenia:</label>
                <input type="time" id="endTime" required min="08:00" max="17:00">
                <br>
                <label for="room">Sala:</label>
                <input type="text" id="room" placeholder="Numer sali" required>
                <br>
                <button type="submit">Dodaj zastępstwo</button>
            </form>
        </div>
    </div>

    <!-- Dialog szczegółów wydarzenia -->
    <dialog id="eventDialog">
        <h2 class="dialog-title"></h2>
        <p class="dialog-description"></p>
        <div class="dialog-details"></div>
        <button onclick="document.getElementById('eventDialog').close();">Zamknij</button>
    </dialog>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const classSelectMain = document.getElementById('class-select');
        const replacementClassSelect = document.getElementById('replacement-class-select');

        // Funkcja do wypełniania selectów
        function populateClassSelects(classes) {
            [classSelectMain, replacementClassSelect].forEach(select => {
                if (select) {
                    select.innerHTML = ''; // Wyczyść istniejące opcje

                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls.id_class; // Ustaw id_class jako wartość
                        option.textContent = cls.class_name; // Wyświetl class_name
                        select.appendChild(option);
                    });

                    // Ustaw pierwszą opcję jako domyślną
                    if (classes.length > 0) {
                        select.value = classes[0].id_class;
                    }
                }
            });
        }

        // Pobierz klasy z backendu
        fetch('/getAllClasses', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(classes => {
                if (classes.length > 0) {
                    populateClassSelects(classes);
                } else {
                    console.error('Brak dostępnych klas w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania klas:', error));
    });
</script>

{% endblock %}
