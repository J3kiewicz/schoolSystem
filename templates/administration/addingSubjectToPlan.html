{% extends "administration/administrationView.html" %}

{% block mainContent %}

<div class="menu">
    <a href = "/createSchedule" class="btn">Wróć</a>
</div>

<form method='POST' action="/addNewSubjectToPlan">
    <label for="class-select">Wybierz klasę:</label>
    <select id="class-select">
        <option value="" disabled selected>Wybierz klasę</option>
    </select>

    <label for="teacher-select">Wybierz nauczyciela:</label>
    <select id="teacher-select">
        <option value="" disabled selected>Wybierz nauczyciela</option>
    </select>

    <label for="subject-select">Wybierz przedmiot:</label>
    <select id="subject-select">
        <option value="" disabled selected>Wybierz przedmiot</option>
    </select>

    <label for="day-select">Wybierz dzień tygodnia:</label>
    <select id="day-select" name="day_select">
        <option value="" disabled selected>Wybierz przedmiot</option>
        <option value="1">Poniedziałek</option>
        <option value="2">Wtorek</option>
        <option value="3">Środa</option>
        <option value="4">Czwartek</option>
        <option value="5">Piątek</option>
    </select>

    <label for="start_time">Godzina rozpoczęcia:</label>
    <input name="start_time" id="start_time" type="time">

    <label for="roomNumber">Numer sali:</label>
    <input type="text" name="room_number" id="room_number">

    <button type="submit" class="btn">Dodaj lekcję</button>

</form>




<script>

document.querySelector('form').addEventListener('submit', function (event) {
    event.preventDefault(); // Prevent the default form submission

    const id_class = document.getElementById('class-select').value;
    const id_teacher = document.getElementById('teacher-select').value;
    const id_subject = document.getElementById('subject-select').value;
    const day_of_week = document.getElementById('day-select').value;
    const start_time = document.getElementById('start_time').value;
    const room_number = document.getElementById('room_number').value;

    // Construct the data object
    const data = {
        id_class,
        id_teacher,
        id_subject,
        day_of_week,
        start_time,
        room_number,
    };

    // Send the data to the server
    fetch('/addNewSubjectToPlan', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Error submitting form');
            }
        })
        .then(result => {
            console.log('Success:', result);
            alert(result.message); // Show success message
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error submitting form');
        });
});


document.addEventListener('DOMContentLoaded', function () {
        var classSelect = document.getElementById('class-select');
        var teacherSelect = document.getElementById('teacher-select');
        var subjectSelect = document.getElementById('subject-select');


        // Funkcja do wypełniania selecta klasami
        function populateClassSelect(classes) {
            classSelect.innerHTML = '<option value="" disabled selected>Wybierz klasę</option>'; // Wyczyść istniejące opcje
            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls.id_class; // Ustaw id_class jako wartość
                option.textContent = cls.class_name; // Wyświetl class_name
                classSelect.appendChild(option);
            });
        }

        // Pobierz klasy z backendu
        fetch('/getAllClasses', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(classes => {
                if (classes.length > 0) {
                    populateClassSelect(classes); // Wypełnij select klasami
                } else {
                    console.error('Brak dostępnych klas w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania klas:', error));



            // Funkcja do wypełniania selecta nauczycielami
        function populateTeacherSelect(teachers) {
            teacherSelect.innerHTML = '<option value="" disabled selected>Wybierz nauczyciela</option>'; // Wyczyść istniejące opcje
            teachers.forEach(tch => {
                const option = document.createElement('option');
                option.value = tch.id_teacher;
                option.textContent = tch.name; // Wyświetl nazwe nauczyciela
                teacherSelect.appendChild(option);
            });
        }

        // Pobierz klasy z backendu
        fetch('/getTeachersList', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(teachers => {
                if (teachers.length > 0) {
                    populateTeacherSelect(teachers); // Wypełnij select nauczycielami
                } else {
                    console.error('Brak dostępnych nauczycieli w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania nauczycieli:', error));




            // Funkcja do wypełniania selecta przedmiotami
    function populateSubjectSelect(subjects) {
            subjectSelect.innerHTML = '<option value="" disabled selected>Wybierz przedmiot</option>'; 
            subjects.forEach(sbj => {
                const option = document.createElement('option');
                option.value = sbj.id; // Ustaw id jako wartość
                option.textContent = sbj.name; // Wyświetl name
                subjectSelect.appendChild(option);
            });
        }

        // Pobierz klasy z backendu
        fetch('/getSubjectsList', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(subjects => {
                if (subjects.length > 0) {
                    populateSubjectSelect(subjects); // Wypełnij select klasami
                } else {
                    console.error('Brak dostępnych przedmiotów w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania przedmiotów:', error));


    });


    


</script>


{% endblock %}