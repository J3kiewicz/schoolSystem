{% extends "administration/administrationView.html" %}

{% block mainContent %}

<div class="menu">
    <a href="/createSchedule" class="btn">Wróć</a>
</div>

<form id="addLessonForm">
    <label for="class-select">Wybierz klasę:</label>
    <select id="class-select">
        <option value="" disabled selected>Wybierz klasę</option>
    </select>

    <label for="teacher-select">Wybierz nauczyciela:</label>
    <select id="teacher-select">
        <option value="" disabled selected>Wybierz nauczyciela</option>
    </select>

    <label for="subject-select">Wybierz przedmiot:</label>
    <select id="subject-select">
        <option value="" disabled selected>Wybierz przedmiot</option>
    </select>

    <label for="day-select">Wybierz dzień tygodnia:</label>
    <select id="day-select" name="day_select">
        <option value="" disabled selected>Wybierz dzień tygodnia</option>
        <option value="1">Poniedziałek</option>
        <option value="2">Wtorek</option>
        <option value="3">Środa</option>
        <option value="4">Czwartek</option>
        <option value="5">Piątek</option>
    </select>

    <label for="start_time">Godzina rozpoczęcia:</label>
    <input name="start_time" id="start_time" type="time">

    <label for="roomNumber">Numer sali:</label>
    <input type="text" name="room_number" id="room_number">


    <label for="exact_date">Dokładna data jeśli lekcja ma pojawić się jednorazowo</label>
    <input type="date" name="exact_date" id="exact_date">

    <label for="semester_start">Początek semestru:</label>
    <input type="date" name="semester_start" id="semester_start">

    <label for="semester_end">Koniec semestru</label>
    <input type="date" name="semester_end" id="semester_end">

    <button type="submit" class="btn">Dodaj lekcję</button>

</form>




<script>

    document.addEventListener('DOMContentLoaded', function () {
        var classSelect = document.getElementById('class-select');
        var teacherSelect = document.getElementById('teacher-select');
        var subjectSelect = document.getElementById('subject-select');


        // Funkcja do wypełniania selecta klasami
        function populateClassSelect(classes) {
            classSelect.innerHTML = '<option value="" disabled selected>Wybierz klasę</option>'; // Wyczyść istniejące opcje
            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls.id_class; // Ustaw id_class jako wartość
                option.textContent = cls.class_name; // Wyświetl class_name
                classSelect.appendChild(option);
            });
        }

        // Pobierz klasy z backendu
        fetch('/getAllClasses', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(classes => {
                if (classes.length > 0) {
                    populateClassSelect(classes); // Wypełnij select klasami
                } else {
                    console.error('Brak dostępnych klas w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania klas:', error));



        // Funkcja do wypełniania selecta nauczycielami
        function populateTeacherSelect(teachers) {
            teacherSelect.innerHTML = '<option value="" disabled selected>Wybierz nauczyciela</option>'; // Wyczyść istniejące opcje
            teachers.forEach(tch => {
                const option = document.createElement('option');
                option.value = tch.id;
                option.textContent = tch.name; // Wyświetl nazwe nauczyciela
                teacherSelect.appendChild(option);
            });
        }

        // Pobierz klasy z backendu
        fetch('/getTeachersList', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(teachers => {
                if (teachers.length > 0) {
                    populateTeacherSelect(teachers); // Wypełnij select nauczycielami
                } else {
                    console.error('Brak dostępnych nauczycieli w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania nauczycieli:', error));




        // Funkcja do wypełniania selecta przedmiotami
        function populateSubjectSelect(subjects) {
            subjectSelect.innerHTML = '<option value="" disabled selected>Wybierz przedmiot</option>';
            subjects.forEach(sbj => {
                const option = document.createElement('option');
                option.value = sbj.id; // Ustaw id jako wartość
                option.textContent = sbj.name; // Wyświetl name
                subjectSelect.appendChild(option);
            });
        }

        // Pobierz klasy z backendu
        fetch('/getSubjectsList', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => response.json())
            .then(subjects => {
                if (subjects.length > 0) {
                    populateSubjectSelect(subjects); // Wypełnij select klasami
                } else {
                    console.error('Brak dostępnych przedmiotów w bazie danych.');
                }
            })
            .catch(error => console.error('Błąd podczas pobierania przedmiotów:', error));


    });





    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('addLessonForm');

        form.addEventListener('submit', function (event) {
            event.preventDefault(); // Zatrzymaj domyślne przesyłanie formularza

            // Pobierz dane z formularza
            const data = {
                id_class: document.getElementById('class-select').value,
                id_teacher: document.getElementById('teacher-select').value,
                id_subject: document.getElementById('subject-select').value,
                day_of_week: document.getElementById('day-select').value,
                start_time: document.getElementById('start_time').value,
                room_number: document.getElementById('room_number').value,
                exact_date: document.getElementById('exact_date').value,
                semester_start: document.getElementById('semester_start').value,
                semester_end: document.getElementById('semester_end').value,
            };


            if (!data.id_class || !data.id_teacher || !data.id_subject) {
            alert('Wszystkie pola (klasa, nauczyciel, przedmiot) są wymagane!');
            return;
        }

            // Wyślij dane do serwera za pomocą fetch
            fetch('/addNewSubjectToPlan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Błąd podczas przesyłania danych.');
                    }
                })
                .then(result => {
                    console.log('Sukces:', result);
                    alert('Lekcja została pomyślnie dodana.');
                })
                .catch(error => {
                    console.error('Błąd:', error);
                    alert('Wystąpił problem podczas dodawania lekcji.');
                });
        });
    });





</script>


{% endblock %}